import{r as n,d as ie,u as oe,j as e,S as G,C as de,L as ce,D as C,E as d,a5 as R,I as me,a3 as a,J as i,M as ue,k as he,w as U,af as H,ag as z,ah as J,am as xe,an as pe,ao as je,V as j,x as ge,y as W}from"./vendor-Cul97NbA.js";import{U as fe,A as we,i as T}from"./index-STTFwuxj.js";import{u as be}from"./useCustomSwals-CUxdPQJE.js";const ve=()=>{const{user:t,setUser:v,loading:Y}=n.useContext(fe),{showConfirmSwal:V,showSuccessSwal:q,showErrorSwal:h,showInfoSwal:y}=be(),{theme:Q}=n.useContext(we),x=ie(),g=oe(),S=g.state?.from;let c=null;S==="/gallery"?c={text:"Kembali menjelajahi Galeri?",path:"/gallery"}:S==="/presensi"?c={text:"Kembali ke menu Presensi",path:"/presensi"}:S==="/pendaftaran"&&(c={text:"Ingin Melanjutkan Pendaftaran?",path:"/pendaftaran"});const[K,P]=n.useState(null),[X,L]=n.useState(""),[Z,f]=n.useState(!1),[E,_]=n.useState(""),$=s=>{const l=s.target.files[0];if(l){if(l.type!=="image/jpeg"&&l.type!=="image/png"&&l.type!=="image/webp"){y("Format file harus .jpg, .png, atau .webp!");return}if(l.size>4*1024*1024){h("Ukuran gambar tidak boleh lebih dari 4MB!");return}P(l),L(URL.createObjectURL(l))}},[ee,M]=n.useState(!1),[r,A]=n.useState(!1),[w,ae]=n.useState(!1),[F,se]=n.useState(!1),[m,b]=n.useState(!1),[o,I]=n.useState({fullName:"",email:"",phone:"",gender:"",address:"",password:""}),[p,B]=n.useState(""),[u,D]=n.useState("");n.useEffect(()=>{g.state?.needsReload&&(x(g.pathname,{replace:!0,state:{}}),window.location.reload())},[g.state,x]),n.useEffect(()=>{t&&I({fullName:t.fullName||"",email:t.email||"",phone:t.phone||"",gender:t.gender||"",address:t.address||"Desa Bejalen, Bejalen Barat/Timur RT 00 RW 00"})},[t]),n.useEffect(()=>{if(M(!0),t&&t.role==="user"){const s=setTimeout(()=>{M(!1)},3e4);return()=>clearTimeout(s)}},[t]);const N=s=>{let{name:l,value:k}=s.target;l==="phone"&&k.startsWith("0")&&(k="62"+k.substring(1)),I({...o,[l]:k})},te=async()=>{if(!E)return h("Harap masukkan password Anda untuk konfirmasi.");b(!0);try{const s=await T.delete("/auth/profile",{data:{password:E},withCredentials:!0});q(s.data.message),v(null),x("/")}catch(s){h(s.response?.data?.message||"Gagal menghapus akun.")}finally{b(!1),f(!1)}},ne=t&&(new Date-new Date(t.updatedAt))/(1e3*60*60*24)>7,le=async()=>{if({...o},p||u){if(!p||!u){h("Sandi Lama dan Sandi Baru harus diisi!");return}if(u.length<8){y("Kata sandi baru minimal 8 karakter!");return}}const s=new FormData;s.append("fullName",o.fullName),s.append("email",o.email),s.append("phone",o.phone),s.append("gender",o.gender),s.append("address",o.address),p&&u&&(s.append("oldPassword",p),s.append("password",u)),K&&s.append("profilePicture",K),b(!0);try{const l=await T.put("/auth/profile",s,{withCredentials:!0});v(l.data.user),W.success(e.jsxs("div",{children:["Profil berhasil diperbarui!",e.jsx("br",{}),"Halaman akan dimuat ulang..."]}),{theme:Q}),A(!1),P(null),L(""),B(""),D("")}catch(l){W.error(l.response?.data?.message||"Gagal memperbarui profil.")}finally{b(!1)}setTimeout(()=>{window.location.reload()},2050)},re=()=>{A(!1),I({fullName:t.fullName||"",email:t.email||"",phone:t.phone||"",gender:t.gender||"",address:t.address||"Desa Bejalen, Bejalen Barat/Timur RT 00 RW 00"}),P(null),L(""),B(""),D("")},O=async()=>{if(await V("Yakin ingin Logout?","Anda akan segera melakukan Logout!")){try{await T.get("/auth/logout",{withCredentials:!0}),sessionStorage.clear(),v(null),ge(),y("Anda telah berhasil Logout."),x("/")}catch{h("Logout gagal, coba lagi.")}setTimeout(()=>{window.location.reload()},1050)}};return Y?e.jsx("div",{className:"text-center my-5",children:e.jsx(G,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx("section",{id:"userprofile",className:"d-flex my-4 align-items-center justify-content-center",children:e.jsxs(de,{children:[e.jsx(ce,{position:"bottom-center",autoClose:3e3}),e.jsxs(C,{className:"justify-content-md-center",children:[e.jsxs(d,{xs:12,lg:4,className:"mb-4 mb-lg-0 order-lg-1",children:[e.jsxs(R,{className:"p-4 align-items-center shadow-sm text-center",children:[e.jsx("h2",{className:"section-title",children:"Foto Profil"}),e.jsx("hr",{className:"w-100"}),e.jsx("div",{className:"profile-image-container",children:e.jsx(me,{src:X||(t?.profilePicture?t.profilePicture:"/default-avatar.png"),alt:"FotoProfil"})}),r?e.jsx(e.Fragment,{children:e.jsxs(a.Group,{controlId:"formFile",className:"mb-2 w-100",children:[e.jsxs(a.Label,{children:["Pastikan ukuran ",e.jsx("strong",{children:"tidak melebihi 4MB"})]}),e.jsx(a.Control,{type:"file",onChange:$,style:{cursor:"pointer"},accept:"image/jpeg, image/png, image/webp"})]})}):e.jsx("small",{className:"text-muted small",children:'"Edit Data" untuk mengubah data dan foto profil.'})]}),ee&&e.jsx("div",{className:"text-center mt-3",children:t.role==="admin"||t.role==="superAdmin"?e.jsxs(i,{className:"btn-role w-100 section-subtitle text-light shadow-sm",onClick:()=>x("/admin"),children:[e.jsx(ue,{className:"me-2"})," Ke Dashboard"]}):e.jsxs(i,{as:"a",href:"/",className:"btn-role d-block d-lg-none w-100 section-subtitle text-light shadow-sm",children:[e.jsx(he,{className:"me-2"})," Ke Beranda"]})}),c&&t?.role==="user"&&e.jsx("div",{className:"text-center mt-2",children:e.jsx(i,{variant:"info",className:"w-100 text-light border-0",as:"a",href:c.path,children:c.text})}),e.jsx("div",{className:"d-none d-lg-block text-center mt-3",children:e.jsxs(i,{variant:"danger",className:"btn-logout section-subtitle text-light w-100",onClick:O,children:[e.jsx(U,{className:"m-2"}),"Logout"]})})]}),e.jsx(d,{xs:12,lg:8,className:"order-lg-3",children:e.jsxs(R,{className:"p-4 shadow-sm",children:[e.jsx("h2",{className:"section-title",children:"Data Anda"}),e.jsx("hr",{}),e.jsxs(a,{children:[e.jsxs(a.Group,{className:"mb-2",controlId:"formName",children:[e.jsx(a.Label,{children:"Nama Lengkap:"}),e.jsx(a.Control,{type:"text",name:"fullName",value:o.fullName,onChange:N,readOnly:!r})]}),e.jsxs(C,{children:[e.jsx(d,{xs:12,md:6,children:e.jsxs(a.Group,{className:"mb-2",controlId:"formEmail",children:[e.jsx(a.Label,{children:"Email:"}),e.jsxs(H,{children:[e.jsx(a.Control,{type:"text",name:"email",value:r&&w?o.email:"•••••••",readOnly:!r,className:!r||!w?"password-mask":""}),r&&e.jsx(i,{variant:"outline-secondary",onClick:()=>ae(!w),children:w?e.jsx(z,{}):e.jsx(J,{})})]})]})}),e.jsx(d,{xs:12,md:6,children:e.jsxs(a.Group,{className:"mb-2",controlId:"formPhone",children:[e.jsx(a.Label,{children:"Nomor Telepon:"}),e.jsx(a.Control,{type:"tel",name:"phone",value:o.phone,onChange:N,readOnly:!r})]})})]}),e.jsxs(a.Group,{className:"mb-2",controlId:"formGender",children:[e.jsx(a.Label,{children:"Jenis Kelamin:"}),e.jsxs(a.Select,{name:"gender",value:o.gender||"",onChange:N,disabled:!r,className:"text-center",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Pilih Jenis Kelamin --"}),e.jsx("option",{value:"Laki-laki",children:"Laki-laki"}),e.jsx("option",{value:"Perempuan",children:"Perempuan"})]})]}),e.jsxs(a.Group,{className:"mb-2",controlId:"formAddress",children:[e.jsx(a.Label,{children:"Alamat:"}),e.jsx(a.Control,{as:"textarea",rows:3,name:"address",value:o.address,onChange:N,readOnly:!r})]}),r?e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("p",{className:"text-muted small",children:"Isi jika Anda ingin mengubah kata sandi."}),e.jsxs(C,{children:[e.jsx(d,{md:6,children:e.jsxs(a.Group,{className:"mb-2",controlId:"formPassword",children:[e.jsx(a.Label,{children:"Kata Sandi Lama:"}),e.jsx(a.Control,{type:"password",placeholder:"Masukkan sandi lama",value:p,onChange:s=>B(s.target.value)})]})}),e.jsx(d,{md:6,children:e.jsxs(a.Group,{className:"mb-2",controlId:"formNewPassword",children:[e.jsx(a.Label,{children:"Kata Sandi Baru:"}),e.jsxs(H,{children:[e.jsx(a.Control,{type:F?"text":"password",placeholder:"Minimal 8 karakter",value:u,onChange:s=>D(s.target.value)}),e.jsx(i,{variant:"outline-secondary",onClick:()=>se(!F),children:F?e.jsx(z,{}):e.jsx(J,{})})]})]})})]})]}):e.jsxs(a.Group,{className:"mb-2",controlId:"formPassword",children:[e.jsx(a.Label,{children:"Kata Sandi:"}),e.jsx(a.Control,{type:"password",value:"********",readOnly:!0})]}),e.jsxs("div",{className:"text-center justify-content-center mt-4",children:[r?e.jsxs(C,{className:"justify-content-center g-2",children:[e.jsx(d,{xs:12,md:"auto",children:e.jsxs(i,{variant:"warning",onClick:re,className:"w-100",disabled:m,children:[e.jsx(xe,{className:"me-2"}),"Batal Edit"]})}),e.jsx(d,{xs:12,md:"auto",children:e.jsxs(i,{variant:"success",onClick:le,className:"w-100",disabled:m,children:[m?e.jsx(G,{size:"sm",className:"me-2"}):e.jsx(pe,{className:"me-2"}),"Simpan Perubahan"]})})]}):e.jsxs(i,{variant:"secondary",onClick:()=>A(!0),className:"w-100",children:[e.jsx(je,{className:"me-2"}),"Edit Data"]}),r&&(t.role==="admin"||t.role==="superAdmin")&&ne&&e.jsx(i,{variant:"danger",onClick:()=>f(!0),className:"w-75 mt-2",disabled:m,children:"Hapus Akun?"}),!r&&e.jsx("div",{className:"d-lg-none text-center mt-3",children:e.jsxs(i,{variant:"danger",className:"btn-logout section-subtitle text-light w-100",onClick:O,children:[e.jsx(U,{className:"m-2"}),"Logout"]})})]})]})]})})]})]})}),e.jsxs(j,{show:Z,onHide:()=>f(!1),centered:!0,children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{className:"text-danger",children:"Konfirmasi Hapus Akun"})}),e.jsxs(j.Body,{children:[e.jsx("p",{children:"Tindakan ini **tidak bisa dibatalkan**. Semua data Anda akan dihapus secara permanen."}),e.jsx("p",{children:"Untuk melanjutkan, silakan masukkan password Anda saat ini:"}),e.jsx(a.Control,{type:"password",placeholder:"Masukkan password...",value:E,onChange:s=>_(s.target.value)})]}),e.jsxs(j.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:()=>f(!1),children:"Batal"}),e.jsx(i,{variant:"danger",onClick:te,disabled:m,children:m?e.jsx(G,{size:"sm"}):"Ya, Hapus Akun Saya"})]})]})]})};export{ve as default};
