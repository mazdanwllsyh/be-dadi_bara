import{r as t,j as e,S as X,C as v,D as Z,E as S,a5 as m,aq as E,aa as _,J as r,aO as D,a3 as a,af as F,ag as P,ah as z,an as ee,aD as se,ao as ae,aE as ne,aC as te,V as u,y as o}from"./vendor-Cul97NbA.js";import{U as ie,i as N}from"./index-STTFwuxj.js";import{u as re}from"./useCustomSwals-CUxdPQJE.js";const oe=()=>{const{user:x}=t.useContext(ie),[G,f]=t.useState(!0),[b,B]=t.useState([]),[h,$]=t.useState([]),[d,j]=t.useState(null),{showConfirmSwal:H,showSuccessSwal:L,showErrorSwal:q}=re(),[y,M]=t.useState({}),[T,p]=t.useState(!1),[l,A]=t.useState({fullName:"",email:"",password:"",phone:""}),[C,I]=t.useState(!1),g=async()=>{f(!0);try{const s=await N.get("/auth/management/users",{withCredentials:!0});B(s.data.superAdmins),$(s.data.admins)}catch(s){o.error(s.response?.data?.message||"Gagal memuat data admin.")}finally{f(!1)}};t.useEffect(()=>{x?.role==="superAdmin"?g():x&&f(!1)},[x]);const w=s=>{const{name:i,value:n}=s.target;let c=n;i==="phone"&&n.startsWith("0")&&(c=`62${n.substring(1)}`),A(Q=>({...Q,[i]:c}))},U=async()=>{if(!l.fullName||!l.email||!l.password||!l.phone)return o.error("Semua field wajib diisi!");try{await N.post("/auth/admins",l,{withCredentials:!0}),o.success("Admin baru berhasil ditambahkan!"),p(!1),A({fullName:"",email:"",password:"",phone:""}),g()}catch(s){o.error(s.response?.data?.message||"Gagal menambah admin.")}},W=async s=>{if(await H("Yakin ingin menghapus?","Admin ini akan dihapus secara permanen!"))try{await N.delete(`/auth/admins/${s}`,{withCredentials:!0}),L("Admin berhasil dihapus."),g()}catch(n){q(n.response?.data?.message||"Gagal menghapus admin.")}},O=s=>{j({...s,password:""})},R=()=>{j(null)},k=s=>{const{name:i,value:n}=s.target;j(c=>({...c,[i]:n}))},V=async()=>{if(d)try{const{_id:s,fullName:i,password:n}=d,c={fullName:i};n&&(c.password=n),await N.put(`/auth/admins/${s}`,c,{withCredentials:!0}),o.success(`Data ${d.fullName} berhasil diperbarui.`),j(null),g()}catch(s){o.error(s.response?.data?.message||"Gagal memperbarui admin.")}},J=s=>s?`${s.substring(0,2)}****${s.substring(s.indexOf("@"))}`:"",Y=t.useMemo(()=>b,[b]),K=t.useMemo(()=>h,[h]);return G?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"90vh"},children:e.jsx(X,{})}):x?.role!=="superAdmin"?e.jsxs(v,{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"90vh"},children:[e.jsx("h2",{className:"text-danger section-title",children:"Akses Ditolak"}),e.jsx("p",{children:"Anda tidak memiliki izin untuk mengakses halaman ini."})]}):e.jsxs(v,{className:"dashboard-container my-3",children:[e.jsxs(Z,{children:[e.jsx(S,{md:12,className:"mb-4",children:e.jsxs(m,{className:"shadow-sm",children:[e.jsx(E,{children:e.jsx("h3",{className:"section-title mb-0",children:"Data Super Admin"})}),e.jsx(m.Body,{children:e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"th-short align-middle text-center",children:"#"}),e.jsx("th",{children:"Nama"}),e.jsx("th",{children:"Email"}),e.jsx("th",{className:"align-middle text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:Y.map((s,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle text-center",children:i+1}),e.jsx("td",{className:"align-middle",children:s.fullName}),e.jsx("td",{className:"align-middle",children:J(s.email)}),e.jsx("td",{className:"align-middle text-center",children:e.jsxs(r,{as:"a",href:`https://wa.me/${s.phone}`,target:"_blank",size:"sm",style:{backgroundColor:"#25D366",border:"none"},disabled:!s.phone,children:[e.jsx(D,{})," Hubungi"]})})]},s._id))})]})})]})}),e.jsx(S,{md:12,children:e.jsxs(m,{className:"shadow-sm",children:[e.jsx(E,{children:e.jsx("h3",{className:"mb-0 section-title",children:"Data Admin"})}),e.jsx(m.Body,{children:e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"th-short align-middle text-center",children:"#"}),e.jsx("th",{style:{minWidth:"155px"},children:"Nama"}),e.jsx("th",{className:"align-middle text-center",children:"Email"}),e.jsx("th",{style:{minWidth:"125px"},children:"Password"}),e.jsx("th",{className:"align-middle text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:K.map((s,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle text-center",children:i+1}),e.jsx("td",{className:"align-middle",children:d?._id===s._id?e.jsx(a.Control,{type:"text",name:"fullName",value:d.fullName,onChange:k}):s.fullName}),e.jsx("td",{className:"align-middle",children:s.email}),e.jsx("td",{className:"align-middle",children:d?._id===s._id?e.jsxs(F,{children:[e.jsx(a.Control,{type:y[s._id]?"text":"password",name:"password",placeholder:"Password Baru (opsional)",onChange:k}),e.jsx(r,{variant:"outline-secondary",onClick:()=>M(n=>({...n,[s._id]:!n[s._id]})),children:y[s._id]?e.jsx(P,{}):e.jsx(z,{})})]}):"********"}),e.jsx("td",{className:"align-middle",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:d?._id===s._id?e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(r,{variant:"success",size:"sm",onClick:V,children:e.jsx(ee,{})}),e.jsx(r,{variant:"secondary",size:"sm",onClick:R,children:e.jsx(se,{})})]}):e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(r,{variant:"warning",size:"sm",onClick:()=>O(s),children:e.jsx(ae,{})}),e.jsx(r,{as:"a",href:`https://wa.me/${s.phone}`,target:"_blank",style:{backgroundColor:"#25D366",border:"none"},size:"sm",children:e.jsx(D,{})}),e.jsx(r,{variant:"danger",size:"sm",onClick:()=>W(s._id),children:e.jsx(ne,{})})]})})})]},s._id))})]})}),h.length<7&&e.jsx(m.Footer,{className:"text-center",children:e.jsxs(r,{variant:"secondary",onClick:()=>p(!0),className:"w-50",children:[e.jsx(te,{className:"me-2"}),"Tambah Admin Baru (Sisa ",7-h.length,")"]})})]})})]}),e.jsxs(u,{show:T,onHide:()=>p(!1),centered:!0,children:[e.jsx(u.Header,{closeButton:!0,children:e.jsxs(u.Title,{className:"section-title",children:["Tambah Admin ",h.length+1]})}),e.jsx(u.Body,{children:e.jsxs(a,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Nama Lengkap"}),e.jsx(a.Control,{type:"text",name:"fullName",value:l.fullName,onChange:w,required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Email"}),e.jsx(a.Control,{type:"email",name:"email",value:l.email,onChange:w,required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Nomor Handphone"}),e.jsx(a.Control,{type:"tel",name:"phone",placeholder:"Awali dengan 62",value:l.phone,onChange:w,required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Password"}),e.jsxs(F,{children:[e.jsx(a.Control,{type:C?"text":"password",name:"password",value:l.password,onChange:w,placeholder:"Pastikan Password yang kuat",required:!0}),e.jsx(r,{variant:"outline-secondary",onClick:()=>I(!C),children:C?e.jsx(P,{}):e.jsx(z,{})})]})]})]})}),e.jsxs(u.Footer,{children:[e.jsx(r,{variant:"secondary",onClick:()=>p(!1),children:"Batal"}),e.jsx(r,{variant:"primary",onClick:U,children:"Simpan"})]})]})]})};export{oe as default};
