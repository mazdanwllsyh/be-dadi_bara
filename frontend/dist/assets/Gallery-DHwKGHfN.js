import{r as s,d as q,u as _,A as z,j as e,J as y,a5 as h,a3 as u,a6 as W,a7 as E,y as v,S as R,D,E as k,I as H,h as G,C as J,z as O,a8 as N}from"./vendor-Cul97NbA.js";import{U,i as I,A as Y}from"./index-STTFwuxj.js";import{u as $,D as Q}from"./usePagination-D2N1ObOo.js";G.locale("id");const V=()=>{const{user:n,setUser:l}=s.useContext(U),[r,C]=s.useState([]),T=q(),j=_(),[L,c]=s.useState(!0),[d,f]=s.useState({rating:0,message:""}),[g,x]=s.useState(!1),[S,w]=s.useState(!1),[p,m]=s.useState(0),[A,P]=s.useState("w-75");s.useEffect(()=>{z.init({duration:1700,easing:"fade-left",once:!0}),(async()=>{c(!0);try{const o=await I.get("/testimonials");C(o.data.testimonials)}catch{v.error("Gagal memuat data testimoni.")}finally{c(!1)}})()},[]),s.useEffect(()=>{n&&g&&f(a=>({...a,name:n.fullName}))},[n,g]),s.useEffect(()=>{const a=()=>P(window.innerWidth<768?"w-75":"w-50");return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)}),s.useEffect(()=>{if(r.length<2)return;const a=setInterval(()=>{m(o=>(o+1)%r.length)},7900);return()=>clearInterval(a)},[r.length]);const t=a=>{const{name:o,value:b}=a.target;f(B=>({...B,[o]:b}))},i=a=>{f(o=>({...o,rating:a}))},K=async a=>{if(a.preventDefault(),!d.message||d.rating===0)return v.error("Rating dan pesan tidak boleh kosong.");try{const b=(await I.post("/testimonials",{message:d.message,rating:d.rating},{withCredentials:!0})).data.testimonial;C([b,...r]),m(0),v.success("Testimoni berhasil dikirim! Terima kasih."),x(!1),f({rating:0,message:""});const B={...n,hasSubmittedTestimonial:!0};l(B);const M=await I.get("/auth/getuser",{withCredentials:!0});l(M.data.user)}catch(o){v.error(o.response?.data?.message||"Gagal mengirim testimoni.")}finally{w(!1)}},F=()=>{if(L)return e.jsx("div",{className:"text-center my-5",children:e.jsx(R,{animation:"border"})});if(!r||r.length===0)return e.jsx("p",{className:"text-center my-5 section-subtitle",children:"Saat ini belum ada testimoni. Jadilah yang pertama memberikan testimoni!"});const a=r[p];return!a||!a.user?e.jsx("p",{className:"text-center text-danger",children:"Gagal memuat data testimoni ini."}):e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx(y,{onClick:()=>m((p-1+r.length)%r.length),className:"carousel-prev shadow btn-secondary",children:"<"}),e.jsx(h,{className:"w-75 mx-auto testimonial-card shadow","data-aos":"fade-down",children:e.jsx(h.Body,{children:e.jsxs("fieldset",{children:[e.jsxs(D,{className:"justify-content-center align-items-center mb-3",children:[e.jsx(k,{xs:"auto",children:e.jsx(H,{src:a.user.profilePicture?a.user.profilePicture:"/default-avatar.png",alt:a.user.fullName,width:"80",height:"80",roundedCircle:!0,style:{objectFit:"cover"}})}),e.jsx(k,{xs:"auto",children:e.jsx("legend",{className:"text-subtitle fw-bold m-0",children:a.user.fullName})})]}),e.jsxs("p",{className:"text-justify text-lg-center testimonial-message",style:{whiteSpace:"pre-wrap"},children:['"',a.message,'"']}),e.jsx("div",{className:"testimonial-rating text-center",children:[...Array(5)].map((o,b)=>e.jsx(E,{color:b<a.rating?"#ffc107":"#e4e5e9"},b))}),e.jsxs("p",{className:"text-center section-subtitle small my-3",children:["Pada: ",G(a.createdAt).format("D MMMM YYYY, HH:mm")]})]})})}),e.jsx(y,{onClick:()=>m((p+1)%r.length),className:"carousel-next shadow btn-secondary",children:">"})]})};return e.jsxs("div",{className:"testimonials mt-5 position-relative","data-aos":"fade-up",children:[e.jsx("h3",{className:"section-title text-center mb-4",children:"Testimoni Pengguna"}),F(),e.jsx("div",{className:"text-center mt-3","data-aos":"fade-up",children:n&&n.hasSubmittedTestimonial?e.jsx("p",{className:"text-success-emphasis section-subtitle",children:"Terima kasih, Anda sudah mengirimkan testimoni."}):e.jsx(e.Fragment,{children:n?n.role==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:()=>x(!g),variant:g?"danger":"secondary",className:"w-75 section-subtitle text-light","data-aos":"fade-up",children:g?"Batal":"Tambahkan Testimoni"}),g&&e.jsxs(h,{className:`${A} mx-auto p-3 testimonial-form mt-3`,"data-aos":"zoom-in",children:[e.jsx("h3",{className:"text-center text-title fw-bold mb-3",children:"Testimoni Baru"}),e.jsxs(u,{onSubmit:K,children:[e.jsx(W,{label:"*Nama Anda",children:e.jsx(u.Control,{type:"text",name:"name",placeholder:"Nama Anda",value:d.name,readOnly:!0,required:!0,style:{cursor:"not-allowed"}})}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"mt-4 section-subtitle",children:"Penilaian Anda:"}),e.jsx("div",{children:[...Array(5)].map((a,o)=>e.jsx(E,{color:o<d.rating?"gold":"silver",onClick:()=>i(o+1),style:{cursor:"pointer",margin:"0 12px"}},o))})]}),e.jsxs(u.Group,{label:"Bagikan pengalaman Anda...",className:"mb-3",children:[e.jsx(u.Label,{className:"mt-2",children:"Bagikan pengalaman Anda terhadap Dadi Bara . . ."}),e.jsx(u.Control,{as:"textarea",name:"message",rows:3,placeholder:"Keren sih ini . . . (Tambahin Sendiri)",value:d.message,onChange:t,required:!0,minLength:30})]}),e.jsx(y,{variant:"success",className:"w-75 section-subtitle text-light",type:"submit",children:"Kirim Testimoni"})]})]})]}):e.jsx(y,{onClick:()=>T("/login",{state:{background:j}}),className:"w-75 section-subtitle text-light btn-info",children:"Login untuk Tambah Testimoni"})})})]})},X=n=>{let l=n.length,r;for(;l!==0;)r=Math.floor(Math.random()*l),l--,[n[l],n[r]]=[n[r],n[l]];return n},ae=()=>{const{data:n}=s.useContext(Y),[l,r]=s.useState([]),[C,T]=s.useState(!0),[j,L]=s.useState(""),[c,d]=s.useState(1),[f,g]=s.useState(window.innerWidth<992),[x,S]=s.useState(f?2:6);s.useEffect(()=>{const t=()=>{const i=window.innerWidth;i<768?S(3):i<992?S(4):S(6)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),s.useEffect(()=>{(async()=>{T(!0);try{const i=await I.get("/gallery");r(X(i.data||[]))}catch{v.error("Gagal memuat gambar galeri.")}finally{T(!1)}})(),z.init({duration:1200,easing:"ease-in-out",once:!0})},[]);const w=s.useMemo(()=>l.filter(t=>t.title.toLowerCase().includes(j.toLowerCase())||t.description&&t.description.toLowerCase().includes(j.toLowerCase())),[j,l]),p=t=>d(t),m=$({currentPage:c,totalCount:w.length,siblingCount:1,pageSize:x}),A=s.useMemo(()=>{const t=(c-1)*x,i=t+x;return w.slice(t,i)},[c,w,x]),P=t=>{const i=["fade-up","fade-down","fade-right","fade-left","zoom-in","zoom-out"];return i[t%i.length]};return C?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"50vh"},children:e.jsx(R,{animation:"border"})}):e.jsx(J,{children:e.jsxs("section",{id:"gallery",className:"gallery-section py-5",children:[e.jsxs(O,{children:[e.jsx("title",{children:"Galeri Kegiatan | Karang Taruna Dadi Bara"}),e.jsx("link",{rel:"canonical",href:"https://dadibara.bejalen.com/gallery"}),e.jsx("meta",{name:"description",content:"Jelajahi dokumentasi foto dari berbagai program kerja dan acara seru yang telah diselenggarakan oleh Karang Taruna DADI BARA Bejalen dan beberapa Testimoni dari beberapa Pengguna."}),e.jsx("meta",{property:"og:title",content:"Galeri Kegiatan | Karang Taruna Dadi Bara"}),e.jsx("meta",{property:"og:description",content:"Lihat momen-momen terbaik dari kegiatan kami, mulai dari acara sosial hingga perlombaan."}),e.jsx("meta",{property:"og:url",content:"https://dadibara.bejalen.com/gallery"}),e.jsx("meta",{property:"og:image",content:"https://res.cloudinary.com/dr7olcn4r/image/upload/v1754892337/karang-taruna-uploads/p4qhg0nacmqjlp2duipu.png"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:site_name",content:"Karang Taruna DADI BARA"}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Galeri Kegiatan | Karang Taruna Dadi Bara"}),e.jsx("meta",{name:"twitter:description",content:"Jelajahi dokumentasi foto dari berbagai program kerja dan acara seru Karang Taruna DADI BARA."}),e.jsx("meta",{name:"twitter:image",content:"https://res.cloudinary.com/dr7olcn4r/image/upload/v1754892337/karang-taruna-uploads/p4qhg0nacmqjlp2duipu.png"})]}),e.jsxs("div",{className:"container align-items-center",children:[e.jsxs("h2",{className:"section-title text-center","data-aos":"fade-up",children:["Galeri ",n.namaOrganisasi]}),e.jsxs(D,{className:"my-3 align-items-center","data-aos":"zoom-in",children:[e.jsx(k,{xs:12,md:6,className:"order-2 order-md-1 d-flex justify-content-center justify-content-md-start",children:e.jsxs(N,{className:"shadow-sm mb-0",children:[e.jsx(N.Prev,{onClick:()=>p(c-1),disabled:c===1}),m.map((t,i)=>t===Q?e.jsx(N.Ellipsis,{disabled:!0},`dots-${i}`):e.jsx(N.Item,{active:t===c,onClick:()=>p(t),children:t},t)),e.jsx(N.Next,{onClick:()=>p(c+1),disabled:c===m[m.length-1]})]})}),e.jsx(k,{xs:12,md:6,className:"order-1 order-md-2 d-flex justify-content-center justify-content-md-end mb-3 mb-md-0",children:e.jsx(u.Control,{type:"search",placeholder:"Cari berdasarkan judul atau deskripsi...",value:j,onChange:t=>{L(t.target.value),d(1)},className:"shadow w-75 w-md-auto"})})]}),e.jsx(D,{className:"my-3 justify-content-center",children:A.length>0?A.map((t,i)=>e.jsx(k,{xs:12,md:6,lg:4,className:"mb-4 d-flex",children:e.jsxs(h,{className:"w-100 h-100 shadow gallery-card","data-aos":P(i),"data-aos-delay":i*220,children:[e.jsx("div",{style:{overflow:"hidden",borderRadius:"var(--bs-card-inner-border-radius)"},children:e.jsx(h.Img,{variant:"top",src:t.src,alt:t.title,style:{objectFit:"cover",height:"250px"}})}),e.jsxs(h.Body,{children:[e.jsx(h.Title,{className:"text-center text-title fw-bold",children:t.title}),e.jsx(h.Text,{className:"text-title",style:{textAlign:"justify",fontSize:"14px"},children:t.description})]})]})},t._id)):e.jsx("p",{className:"text-center",children:"Tidak ada gambar yang cocok dengan pencarian Anda."})}),e.jsx("hr",{style:{height:"3px",width:"100%",backgroundColor:"#ccc",borderRadius:"15px"}}),e.jsx(V,{})]})]})})};export{ae as default};
