import{r as n,ak as Se,y,j as e,S as Ne,C as Te,a5 as l,D as N,E as m,aP as Pe,aQ as Fe,aR as Ie,a3 as s,aG as Ee,J as x,V as w,al as q,aL as Le,ao as Me,aE as Be}from"./vendor-Cul97NbA.js";import{A as Re,i as T}from"./index-STTFwuxj.js";import{u as ze}from"./useCustomSwals-CUxdPQJE.js";const Je=()=>{const{data:K,theme:X}=n.useContext(Re),[Q,Z]=n.useState(window.innerWidth<992),ee={tableWrapper:{style:{borderRadius:"12px",overflowX:Q?"auto":"hidden"}},headRow:{style:{backgroundColor:"rgb(172, 172, 172)",borderBottom:"2px solid #dee2e6"}},headCells:{style:{color:"black",fontFamily:"SF UI Display",fontSize:"1.2rem",fontWeight:"bold",justifyContent:"center",borderRight:"1px solid #dee2e6","&:first-of-type":{borderLeft:"1px solid #dee2e6"}}},rows:{style:{borderBottom:"1px solid #dee2e6"}},cells:{style:{fontSize:"14px",borderRight:"1px solid #dee2e6","&:first-of-type":{borderLeft:"1px solid #dee2e6"},justifyContent:"center",alignItems:"center"}},pagination:{style:{justifyContent:"flex-end",padding:"10px 0"},select:{style:{border:"1px solid #ccc",borderRadius:"5px",padding:"5px",backgroundColor:"rgba(196, 176, 176, 0.9) !important",marginRight:"10px"}}},noData:{style:{display:"flex",alignItems:"center",justifyContent:"center",color:"var(--bs-secondary-color)",backgroundColor:"var(--bs-body-bg)",padding:"24px"}}},[Ye,Ge]=n.useState(!1),[Oe,_e]=n.useState(!1),[R,te]=n.useState([]),[P,z]=n.useState(!1),[h,F]=n.useState({type:"",amount:"",description:"",date:new Date().toISOString().slice(0,10)}),{showConfirmSwal:ae,showSuccessSwal:se,showErrorSwal:ne}=ze(),[I,ie]=n.useState("all"),[b,re]=n.useState("all"),[Y,le]=n.useState(""),[G,oe]=n.useState(5),[ce,He]=n.useState(1),[o,E]=n.useState(null),[p,f]=n.useState({type:"",amount:"",description:"",date:""}),[k,O]=n.useState(null),[_,L]=n.useState(null),[de,H]=n.useState(!0),[ue,W]=n.useState(!1),[g,A]=n.useState({url:null,type:null}),me=Se.defaultLayoutPlugin(),j=n.useCallback(async()=>{H(!0);try{const t=await T.get("/keuangan",{withCredentials:!0});te(t.data||[])}catch(t){y.error(t.response?.data?.message||"Gagal memuat data transaksi.")}finally{H(!1)}},[]);n.useEffect(()=>{j();const t=()=>Z(window.innerWidth<992);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[j]);const C=R.filter(t=>{const a=()=>{if(I==="all")return!0;const r=new Date(t.date),d=new Date,M=d.getFullYear();switch(I){case"today":return r.toDateString()===d.toDateString();case"thisWeek":{const u=new Date(d);u.setDate(d.getDate()-d.getDay()),u.setHours(0,0,0,0);const B=new Date(u);return B.setDate(u.getDate()+6),B.setHours(23,59,59,999),r>=u&&r<=B}case"thisMonth":return r.getMonth()===d.getMonth()&&r.getFullYear()===d.getFullYear();case"lastMonth":{const u=new Date(d);return u.setMonth(d.getMonth()-1),r.getMonth()===u.getMonth()&&r.getFullYear()===u.getFullYear()}case"lastYear":return r.getFullYear()===M-1;case String(M-2):return r.getFullYear()===M-2;default:return!0}},i=()=>b==="all"?!0:b==="Pemasukan"?t.type==="Pemasukan"||t.type==="Pemasukkan":t.type===b,c=()=>{const r=Y.toLowerCase();return t.description,t.type,t.amount&&t.amount.toString(),t.description.toLowerCase().includes(r)||t.type.toLowerCase().includes(r)||t.amount.toString().includes(r)};return a()&&i()&&c()}),U=C.filter(t=>t.type==="Pemasukan"||t.type==="Pemasukkan").reduce((t,a)=>t+(parseFloat(a.amount)||0),0),J=C.filter(t=>t.type==="Pengeluaran").reduce((t,a)=>t+parseFloat(a.amount),0),he=U-J,V=ce*G,pe=V-G;C.slice(pe,V);const v=t=>{const{name:a,value:i}=t.target;if(a==="amount"){const c=i.replace(/[^0-9]/g,"");F(r=>({...r,[a]:c}))}else F(c=>({...c,[a]:i}))},D=t=>{const{name:a,value:i}=t.target;if(a==="amount"){const c=i.replace(/[^0-9]/g,"");f(r=>({...r,[a]:c}))}else f(c=>({...c,[a]:i}))},xe=t=>{if(!t)return"";const a=parseInt(t,10);return isNaN(a)?"":new Intl.NumberFormat("id-ID").format(a)},ge=t=>{const a=t.target.files[0];O(a)},ye=t=>{const a=t.target.files[0];L(a)},fe=async t=>{t.preventDefault();const a=new FormData;a.append("type",h.type),a.append("amount",h.amount),a.append("description",h.description),a.append("date",h.date),k&&a.append("document",k);try{await T.post("/keuangan",a,{withCredentials:!0}),y.success("Transaksi berhasil ditambahkan!"),j(),z(!1),F({type:"",amount:"",description:"",date:new Date().toISOString().slice(0,10)}),O(null)}catch(i){y.error(i.response?.data?.message||"Gagal menambahkan transaksi.")}},je=t=>{const a=R.find(i=>i._id===t);a&&(E(t),f({...a,date:new Date(a.date).toISOString().slice(0,10)}),L(null))},we=async()=>{if(!o){y.error("ID Transaksi tidak ditemukan, tidak bisa menyimpan.");return}const t=new FormData;t.append("type",p.type),t.append("amount",p.amount),t.append("description",p.description),t.append("date",p.date),_&&t.append("document",_);try{await T.put(`/keuangan/${o}`,t,{withCredentials:!0}),y.success("Transaksi berhasil diperbarui!"),j(),E(null),f({type:"",amount:"",description:"",date:""}),L(null)}catch(a){y.error(a.response?.data?.message||"Gagal memperbarui transaksi.")}},be=()=>{E(null),f({type:"",amount:"",description:"",date:""})},ke=t=>{if(!t)return"-";const a={day:"2-digit",month:"long",year:"numeric"};return new Intl.DateTimeFormat("id-ID",a).format(new Date(t))},Ce=async t=>{if(await ae("Yakin ingin menghapus?","Apakah Anda yakin ingin menghapus Data Transaksi ini?"))try{await T.delete(`/keuangan/${t}`,{withCredentials:!0}),se("Transaksi berhasil dihapus!"),j()}catch(i){ne(i.response?.data?.message||"Gagal menghapus transaksi.")}},ve=t=>{if(!t)return;const a=t.split(".").pop().toLowerCase();let i="image";if(a==="pdf")i="pdf";else if(["jpg","jpeg","png","gif"].includes(a))i="image";else{alert("Tipe dokumen tidak didukung.");return}A({url:t,type:i}),W(!0)},$=()=>{W(!1),A({url:null,type:null})},De=[{name:"#",selector:(t,a)=>a+1,sortable:!1,width:"50px"},{name:"Jenis",width:"150px",selector:t=>t.type,sortable:!0,cell:t=>o===t._id?e.jsxs(s.Control,{as:"select",size:"sm",name:"type",value:p.type,onChange:D,children:[e.jsx("option",{value:"Pemasukan",children:"Pemasukan"}),e.jsx("option",{value:"Pengeluaran",children:"Pengeluaran"})]}):t.type},{name:"Jumlah",width:"200px",selector:t=>t.amount,sortable:!0,cell:t=>o===t._id?e.jsx(s.Control,{type:"number",size:"sm",name:"amount",value:p.amount,onChange:D}):`Rp ${t.amount.toLocaleString("id-ID")}`},{name:"Deskripsi",width:"250px",selector:t=>t.description,grow:2,wrap:!0,cell:t=>o===t._id?e.jsx(s.Control,{as:"textarea",size:"sm",name:"description",value:p.description,onChange:D}):t.description},{name:"Tanggal",width:"180px",selector:t=>t.date,sortable:!0,cell:t=>o===t._id?e.jsx(s.Control,{type:"date",size:"sm",name:"date",value:p.date,onChange:D}):ke(t.date)},{name:"Bukti",cell:t=>e.jsxs(e.Fragment,{children:[t.document&&o!==t._id&&e.jsxs(x,{variant:"primary",className:"w-100 my-2",onClick:()=>ve(t.document),children:[e.jsx(Le,{})," Lihat"]}),o===t._id&&e.jsx(s.Control,{type:"file",size:"sm",onChange:ye}),!t.document&&o!==t._id&&"-"]})},{name:"Aksi",button:!0,width:"150px",cell:t=>o===t._id?e.jsxs("div",{className:"d-flex flex-column gap-2 my-2",children:[e.jsx(x,{variant:"success",size:"sm",onClick:we,children:"Simpan"}),e.jsx(x,{variant:"secondary",size:"sm",onClick:be,children:"Batal"})]}):e.jsxs("div",{className:"d-flex flex-column gap-2 py-2",children:[e.jsxs(x,{variant:"warning",size:"sm",onClick:()=>je(t._id),children:[e.jsx(Me,{})," Edit"]}),e.jsxs(x,{variant:"danger",size:"sm",onClick:()=>Ce(t._id),children:[e.jsx(Be,{})," Hapus"]})]})}];if(de)return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"90vh"},children:e.jsx(Ne,{animation:"border"})});const S=new Date().getFullYear();return e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"dashboard-container my-3",children:e.jsxs(l,{className:"shadow",children:[e.jsx(l.Header,{className:"bg-secondary text-light",children:e.jsxs("h5",{className:"mb-0 section-title",children:["Dashboard Keuangan ",K.namaOrganisasi]})}),e.jsxs(l.Body,{className:"p-3",children:[e.jsxs(N,{className:"mb-3 row-cols-1 row-cols-md-3 g-3",children:[e.jsx(m,{children:e.jsx(l,{className:"bg-success text-white shadow-sm h-100",children:e.jsxs(l.Body,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h5",{className:"fw-bold text-light SF-UIDisplay",children:"Total Pemasukan"}),e.jsxs("h2",{className:"text-code fw-bold",children:["Rp. ",U.toLocaleString("id-ID")]})]}),e.jsx(Pe,{size:40,style:{opacity:.8}})]})})}),e.jsx(m,{children:e.jsx(l,{className:"bg-danger text-white shadow-sm h-100",children:e.jsxs(l.Body,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h5",{className:"fw-bold text-light SF-UIDisplay",children:"Total Pengeluaran"}),e.jsxs("h2",{className:"text-code fw-bold",children:["Rp. ",J.toLocaleString("id-ID")]})]}),e.jsx(Fe,{size:40,style:{opacity:.8}})]})})}),e.jsx(m,{children:e.jsx(l,{className:"bg-info text-dark shadow-sm h-100",children:e.jsxs(l.Body,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h5",{className:"fw-bold text-dark SF-UIDisplay",children:"Saldo Total"}),e.jsxs("h2",{className:"text-code fw-bold",children:["Rp. ",he.toLocaleString("id-ID")]})]}),e.jsx(Ie,{size:40,style:{opacity:.8}})]})})})]}),e.jsxs(N,{className:"justify-content-between align-items-center mb-3 g-2",children:[e.jsxs(m,{xs:12,md:"auto",className:"d-flex justify-content-center justify-content-md-start gap-2",children:[e.jsxs(s.Control,{as:"select",value:I,onChange:t=>ie(t.target.value),style:{width:"auto"},children:[e.jsx("option",{value:"all",children:"Semua Waktu"}),e.jsx("option",{value:"today",children:"Hari Ini"}),e.jsx("option",{value:"thisWeek",children:"Minggu Ini"}),e.jsx("option",{value:"thisMonth",children:"Bulan Ini"}),e.jsx("option",{value:"lastMonth",children:"Bulan Kemarin"}),e.jsxs("option",{value:"thisYear",children:["Tahun ",S]}),e.jsxs("option",{value:"lastYear",children:["Tahun (",S-1,")"]}),e.jsxs("option",{value:S-2,children:["Tahun (",S-2,")"]})]}),e.jsxs(s.Control,{as:"select",value:b,onChange:t=>re(t.target.value),style:{width:"auto"},children:[e.jsx("option",{value:"all",children:"Semua Jenis"}),e.jsx("option",{value:"Pemasukan",children:"Pemasukan"}),e.jsx("option",{value:"Pengeluaran",children:"Pengeluaran"})]})]}),e.jsx(m,{xs:12,md:4,className:"d-flex justify-content-center justify-content-md-end",children:e.jsx(s.Control,{type:"search",placeholder:"Cari...",value:Y,onChange:t=>le(t.target.value)})})]}),e.jsx("h4",{className:"mt-2 text-custom fw-bold",children:"Rincian Transaksi"}),e.jsx(Ee,{columns:De,data:C,customStyles:ee,striped:!0,pagination:!0,paginationPerPage:5,paginationRowsPerPageOptions:[15,30,60,100,150],onChangeRowsPerPage:t=>oe(t),paginationComponentOptions:{rowsPerPageText:"Baris per halaman:",rangeSeparatorText:"dari"},highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"text-center my-5",children:[e.jsx("h3",{className:"SF-UIDisplay text-danger",children:"Tidak Ada Data untuk Ditampilkan"}),e.jsx("p",{children:"Saat ini belum ada data yang tersedia di dalam tabel ini."})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(x,{variant:"secondary",onClick:()=>z(!P),className:"w-50 mt-3",children:P?"Tutup Form":"Tambah Transaksi Baru"})}),P&&e.jsxs(l,{className:"mt-3",children:[e.jsx(l.Header,{children:e.jsx("h5",{className:"text-custom text-center fw-bold text-body-emphasis",children:"Tambah Transaksi Baru"})}),e.jsx(l.Body,{children:e.jsxs(s,{onSubmit:fe,children:[e.jsxs(N,{children:[e.jsx(m,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:"text-custom fw-bold",children:"Jenis Transaksi"}),e.jsxs(s.Control,{as:"select",name:"type",value:h.type,onChange:v,required:!0,className:"text-center",children:[e.jsx("option",{value:"",disabled:!0,children:"Pemasukan atau Pengeluaran?"}),e.jsx("option",{value:"Pemasukan",children:"Pemasukan"}),e.jsx("option",{value:"Pengeluaran",children:"Pengeluaran"})]})]})}),e.jsx(m,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:"text-custom fw-bold",children:"Jumlah (Rp)"}),e.jsx(s.Control,{type:"text",name:"amount",value:xe(h.amount),onChange:v,placeholder:"Contoh: 500.000",required:!0})]})})]}),e.jsxs(N,{children:[e.jsx(m,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:"text-custom fw-bold",children:"Deskripsi"}),e.jsx(s.Control,{type:"text",name:"description",value:h.description,onChange:v,required:!0,placeholder:"Untuk apa?"})]})}),e.jsx(m,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:"text-custom fw-bold",children:"Tanggal Transaksi"}),e.jsx(s.Control,{type:"date",name:"date",value:h.date,onChange:v,required:!0})]})})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:"text-custom fw-bold",children:"Unggah Bukti Dokumen"}),e.jsx(s.Control,{type:"file",accept:"image/*, application/pdf, application/msword",onChange:ge}),k&&e.jsxs(s.Text,{className:"text-muted",children:["File terpilih: ",k.name]})]}),e.jsx(x,{variant:"primary",type:"submit",children:"Simpan Transaksi"})]})})]})]})]})}),e.jsxs(w,{show:ue,onHide:$,size:"xl",children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{className:"section-title",children:"Dokumen"})}),e.jsx(w.Body,{children:e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"80vh"},children:[g.type==="image"&&g.url&&e.jsx("img",{src:g.url,alt:"Dokumen Transaksi",style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain"}}),g.type==="pdf"&&g.url&&e.jsx("div",{className:`shadow pdf-viewer-container ${X==="dark"?"rpv-core__viewer--dark":""}`,style:{border:"1px solid #ddd",height:"80vh",width:"100%"},children:e.jsx(q.Worker,{workerUrl:"/workers/pdf.worker.min.js",children:e.jsx(q.Viewer,{fileUrl:g.url,plugins:[me]})})})]})}),e.jsx(w.Footer,{children:e.jsx(x,{variant:"secondary",onClick:$,children:"Tutup"})})]})]})};export{Je as default};
