import{j as e,r as s,d as B,ae as H,J as x,S as V,y as j,u as K,z as U,V as f,a3 as d,a6 as M,af as q,ag as _,ah as J,D as $,E}from"./vendor-Cul97NbA.js";import O from"./VerificationStep-DbK0P52A.js";import{U as F,i as w,A as Q}from"./index-STTFwuxj.js";const W=()=>e.jsxs("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",style:{width:"22px",height:"22px"},children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"}),e.jsx("path",{fill:"none",d:"M0 0h48v48H0z"})]}),X=({onLoginSuccess:n,handleClose:i})=>{const{setUser:v}=s.useContext(F);B();const[g,r]=s.useState(!1),u=H({flow:"auth-code",onSuccess:async m=>{r(!0);try{const l=await w.post("/auth/google",{code:m.code});n&&n(l.data.user)}catch(l){j.error(l.response?.data?.message||"Login Google gagal.")}finally{r(!1)}},onError:()=>{j.error("Login Google gagal."),r(!1)}});return e.jsx(x,{className:"btn-google w-100 d-flex align-items-center justify-content-center",onClick:()=>u(),disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(V,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:"Memproses..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx("span",{className:"ms-2",children:"Lanjutkan dengan Google"})]})})},te=({show:n,handleClose:i,handleShowRegister:v})=>{const{data:g,theme:r}=s.useContext(Q),{user:u,setUser:m}=s.useContext(F),l=K(),[p,G]=s.useState(""),[L,I]=s.useState(""),[b,P]=s.useState(!1),[z,A]=s.useState(!1),[y,C]=s.useState(!1),[Y,S]=s.useState(!1),D=()=>{P(!b)},[N,Z]=s.useState(!1),c=B(),k=a=>{if(m(a),j.success(`Login berhasil! Selamat datang, ${a.fullName}`),i(),a.role==="admin"||a.role==="superAdmin")return c("/admin");const o=l.state?.background?.pathname;o==="/presensi"||o==="/pendaftaran"||(o==="/gallery"?Math.random()>.5&&c("/profile",{state:{from:o}}):c("/profile"))},R=async a=>{if(a.preventDefault(),a.currentTarget.checkValidity()===!1){a.stopPropagation(),A(!0);return}C(!0),A(!0);try{const t=await w.post("/auth/login",{email:p,password:L},{withCredentials:!0});k(t.data.user)}catch(t){const h=t.response?.data?.message||"Terjadi kesalahan. Coba Lagi Nanti!";j.error(h,{theme:r}),h.includes("belum diverifikasi")&&(i(),c("/verification",{state:{email:p}}))}finally{C(!1)}};s.useEffect(()=>{const a=new AbortController;return n&&!u&&"credentials"in navigator&&navigator.credentials.get&&(async()=>{S(!0);try{const t=await navigator.credentials.get({signal:a.signal,identity:{providers:[{configURL:"https://accounts.google.com/gsi/fedcm.json",clientId:"308833980192-nj8rado89j8dqchmk81h4pgfti469vrh.apps.googleusercontent.com"}]},mediation:"optional"});if(t&&t.token){const h=await w.post("/auth/google",{credential:t.token});k(h.data.user)}}catch(t){t.name==="AbortError"?console.log("FedCM dibatalkan karena pengguna login dengan cara lain."):console.log("FedCM auto-login dilewati atau dibatalkan oleh pengguna.")}finally{S(!1)}})(),()=>{a.abort()}},[n,u]);const T=a=>{m(a.user),i(),c("/profile")};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx("title",{children:"Login Akun | Karang Taruna Dadi Bara"}),e.jsx("link",{rel:"canonical",href:"https://dadibara.bejalen.com/login"}),e.jsx("meta",{name:"description",content:"Login ke akun Anda untuk menambahkan testimoni dan fitur khusus anggota Karang Taruna DADI BARA Bejalen."}),e.jsx("meta",{name:"robots",content:"noindex, follow"}),e.jsx("meta",{property:"og:title",content:"Login | Karang Taruna Dadi Bara"}),e.jsx("meta",{property:"og:description",content:"Akses dashboard Anda dan kelola profil sebagai pengguna aktif KARTAR DADI BARA."}),e.jsx("meta",{property:"og:url",content:"https://dadibara.bejalen.com/login"}),e.jsx("meta",{property:"og:image",content:"https://res.cloudinary.com/dr7olcn4r/image/upload/v1754596459/landing-page-logos/landing-page-logos-LogoKartar-1754596456138.png"}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"})]}),e.jsxs(f,{show:n,onHide:i,centered:!0,children:[e.jsx(f.Header,{closeButton:!0,children:e.jsxs(f.Title,{className:"section-title fw-bold",children:[e.jsx("img",{src:g.logoDadiBara,alt:"Logo",width:"50",className:"me-2"}),N?"Verifikasi Email":"Login"]})}),e.jsx(f.Body,{children:N?e.jsx(O,{email:p,onVerifySuccess:T}):e.jsxs(d,{noValidate:!0,validated:z,onSubmit:R,children:[e.jsx(d.Group,{className:"mb-3",controlId:"formEmail",children:e.jsx(M,{label:"Masukkan Email",children:e.jsx(d.Control,{type:"email",placeholder:"Masukkan Email",value:p,onChange:a=>G(a.target.value),required:!0})})}),e.jsx(d.Group,{className:"mb-3",controlId:"formPassword",children:e.jsxs(q,{hasValidation:!0,children:[e.jsx(M,{label:"Masukkan Password",children:e.jsx(d.Control,{type:b?"text":"password",placeholder:"Masukkan Password",value:L,onChange:a=>I(a.target.value),required:!0})}),e.jsx(x,{variant:"outline-secondary",onClick:D,children:b?e.jsx(_,{}):e.jsx(J,{})})]})}),e.jsx(x,{variant:"secondary",type:"submit",className:"w-100 mb-3 section-subtitle text-light",disabled:y,children:y?e.jsx(V,{as:"span",animation:"border",size:"sm"}):"Masuk"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-center my-3",children:[e.jsx("div",{className:"flex-grow-1 border-top"}),e.jsx("div",{className:"mx-3 fw-bold opacity-50 section-subtitle",children:"Atau"}),e.jsx("div",{className:"flex-grow-1 border-top"})]}),e.jsx(X,{onLoginSuccess:k}),e.jsxs($,{className:"justify-content-center align-items-baseline mt-3 section-subtitle",children:[e.jsx(E,{xs:"auto",className:"pe-1",children:"Belum punya akun?"}),e.jsx(E,{xs:"auto",className:"ps-0",children:e.jsx(x,{variant:"link",onClick:v,disabled:y,className:"fw-bold p-0 text-decoration-underline",style:{fontSize:"inherit"},children:"Daftar di sini"})})]})]})})]})]})};export{te as default};
