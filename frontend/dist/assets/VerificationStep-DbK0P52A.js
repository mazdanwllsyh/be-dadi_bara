import{r as a,u as E,d as N,j as e,V as n,a3 as x,J as h,a6 as A,S as L,y as o}from"./vendor-Cul97NbA.js";import{A as U,U as B,i as p}from"./index-STTFwuxj.js";const T=({show:k,handleClose:l})=>{const{data:j}=a.useContext(U),i=E(),y=N(),{setUser:v}=a.useContext(B),[c,I]=a.useState(()=>i.state?.email||localStorage.getItem("verificationEmail")||""),[u,S]=a.useState(""),[d,r]=a.useState(!1),[s,f]=a.useState(0),[g,b]=a.useState(0);a.useEffect(()=>{i.state?.email&&localStorage.setItem("verificationEmail",i.state.email)},[i.state?.email]);const C=t=>{v(t.user),localStorage.removeItem("verificationEmail"),l&&l(),y("/profile",{state:{needsReload:!0}})},V=async t=>{t.preventDefault(),r(!0);try{const m=await p.post("/auth/register-verify",{email:c,verificationCode:u},{withCredentials:!0});o.success("Verifikasi berhasil! Selamat datang."),C(m.data)}catch(m){o.error(m.response?.data?.message||"Verifikasi gagal.")}finally{r(!1)}},w=async()=>{if(!(s>0)){r(!0);try{const t=Math.min(30*2**g,120);b(g+1),f(t),await p.post("/auth/resend-verification",{email:c}),o.success("Email verifikasi baru telah dikirim.")}catch(t){o.error(t.response?.data?.message||"Gagal mengirim ulang.")}finally{r(!1)}}};return a.useEffect(()=>{let t;return s>0&&(t=setTimeout(()=>f(s-1),1e3)),()=>clearTimeout(t)},[s]),e.jsxs(n,{show:k,onHide:l,centered:!0,backdrop:"static",keyboard:!1,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{className:"section-title",children:[e.jsx("img",{src:j.logoDadiBara,alt:"Logo",width:"50",className:"me-2"}),"Verifikasi Akun Anda"]})}),e.jsx(n.Body,{children:e.jsxs(x,{onSubmit:V,children:[e.jsxs("p",{className:"text-center",children:["Masukkan kode 6 digit yang dikirim ke ",e.jsx("strong",{children:c}),"."]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("p",{className:"mb-0 small",children:"Tidak menerima kode?"}),e.jsx(h,{variant:"link",className:"p-0 text-decoration-underline",onClick:w,disabled:s>0||d,style:{fontSize:"inherit"},children:s>0?`Kirim Ulang (${s}s)`:"Kirim Ulang"})]}),e.jsx(A,{label:"Kode Verifikasi",children:e.jsx(x.Control,{type:"text",value:u,onChange:t=>S(t.target.value),maxLength:6,required:!0})}),e.jsx(h,{type:"submit",className:"w-100 mt-3",disabled:d,children:d?e.jsx(L,{size:"sm"}):"Verifikasi & Masuk"})]})})]})};export{T as default};
